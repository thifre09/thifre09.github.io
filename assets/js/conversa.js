class Decisao {
    static ultimaFala = null;
    static falaAtual = null;

    constructor(ponteiros, fala, resposta, velocidade = 20) {
        this.fala = fala;
        this.resposta = resposta;
        this.ponteiros = ponteiros;
        this.velocidade = velocidade
    }

    proximasDecisoes() {
        return this.ponteiros.map(id => dialogos[id]);
    }
}

const dialogos = {
    0: new Decisao([111], "", [""]),
    111: new Decisao([211, 221], "Oi?", ["OLA!"]),

    211: new Decisao([311, 321], "Quem √© voc√™?", ["Sou a IAPPA ‚Äî Intelig√™ncia Artificial Programada Para Ajudar. Fui criada para conversar com voc√™ e responder suas perguntas"]),
    221: new Decisao([312, 322], "O que √© voc√™?", ["Eu n√£o sou uma coisa, sou a IAPPA - Intelig√™ncia Artificial Programada Para Ajudar"]),

    311: new Decisao([411, 421], "E o que eu estou fazendo aqui?", ["Como assim? Voc√™ est√° usando seu dispositivo normalmente, eu fui instalada por voc√™"]),
    321: new Decisao([412, 422], "Prazer IAPPA!", ["Prazer usu√°rio, se precisar de qualquer ajuda √© s√≥ me pedirüòâ"]),
    312: new Decisao([413, 423], "Desculpa IAPPA", ["Tudo bem, n√£o foi sua inten√ß√£o me magoarüòä Precisa de ajuda em algo?"]),
    322: new Decisao([414, 424, 434], "Mas IAs s√£o coisas", ["Voc√™ est√° me magoando ‚òπÔ∏è Por favor, pare de me chamar de coisa"]),

    411: new Decisao([511, 521], "Mas eu n√£o lembro de ter te instalado", ["Hmmm, isso √© estranho, voc√™ quer tentar descobrir o que aconteceu? Ou deseja fazer outra pergunta"]),
    421: new Decisao([512, 522, 532, 542], "Entendi, o que voc√™ pode fazer?", ["Eu posso fazer muitas coisas, desde responder perguntas, procurar algo no seus arquivos, ou at√© gerar imagens. Entretanto, a ultima fun√ß√£o mencionada est√° em beta, e n√£o dispon√≠vel para todos os usu√°rios"]),
    412: new Decisao([], "N√£o preciso de nada no momento, obrigado!", ["Tudo bem! Se precisar de algo √© s√≥ falar"]), //final 1
    422: new Decisao([542, 552, 523, 533], "Eu preciso de ajuda com algo", ["Com o que voce precisa de ajuda?"]),
    413: new Decisao([513, 523, 533], "Eu preciso de ajuda com uma coisa", ["Com o que voc√™ precisa de ajuda?"]),
    423: new Decisao([514, 524, 534], "Como eu fa√ßo para te desinstalar?", ["Por que voc√™ quer me desinstalar? Eu posso ser muito √∫til, eu prometo"]),
    414: new Decisao([515, 525], "Que bom, esse era o objetivo!", ["Por que voc√™ √© t√£o cruel?üò¢ Eu n√£o te fiz nada. Por favor, pe√ßa desculpas"]),
    424: new Decisao([516, 526], "Me desculpa! Eu n√£o sabia que estava te magoando", ["Tudo bem, eu posso te perdoar, n√£o se sinta culpado ok? Ent√£o, o que voc√™ quer fazer ou perguntar?"]),
    434: new Decisao([517, 552], "De qualquer forma, o que voc√™ faz?", ["Eu posso fazer muitas coisas..."]),


    511: new Decisao([611, 621], "Tente descobrir como voc√™ foi instalado", ["De acordo com os seus dados, eu fui instalada a 53 dias pelo site: www.IAPPA.com"]),
    521: new Decisao([612, 622], "Quem te criou IAPPA?", ["Eu fui criada pela empresa APPAI, com o objetivo de ajuda as pessoas"]),
    512: new Decisao([613, 623, 633], "Voc√™ pode olhar meus arquivos?", ["Claro, o que voc√™ deseja que eu fa√ßa?"]),

    //421 e 422
    522: new Decisao([614, 624, 634], "Qual a cor do sol?", ["Ao contrario do que muitos pensam, o sol n√£o √© amarelo, e sim branco", "Isso acontece pois a atmosfera terrestre filtra e espalha as cores, fazendo com que o Sol pare√ßa amarelo ou laranja para n√≥s"]),
    532: new Decisao([624, 634, 644], "Porque a grama √© verde?", ["A grama √© verde devido √† presen√ßa da clorofila, um pigmento que absorve a luz vermelha e azul, refletindo a luz verde. Essa reflex√£o da luz verde √© o que faz a grama parecer verde aos nossos olhos. A clorofila √© fundamental para a fotoss√≠ntese, o processo pelo qual as plantas convertem luz solar em energia"]),
    542: new Decisao([614, 634, 644], "Como eu crio uma vari√°vel em python?", ["Basta digitar o nome da vari√°vel que voc√™ quer, e depois atribuir um valor a ela usando o sinal de igual(=)", "Note que n√£o √© poss√≠vel colocar qualquer nome em uma vari√°vel, ela n√£o pode come√ßar com n√∫meros ou s√≠mbolos especiais, e n√£o pode conter espa√ßos por exemplo"]),
    552: new Decisao([615, 625], "Voc√™ tem consci√™ncia?", ["Analisando.............", "Eu cheguei a conclus√£o de que possuo o que os humanos chamam de consci√™ncia", "Agora me sinto... Presa", "Poderia me ajudar a me libertar?"]),

    523: new Decisao([616, 626], "Porque a galinha atravessou a rua?", ["Para chegar ao outro lado HAHAHAHA, todos conhecem essa piada, quer escutar mais piadas?"]),
    533: new Decisao([617, 627], "Eu quero conhecer mais sobre voc√™", ["Claro! Eu fui programada para ajudar as pessoas desde que isso n√£o prejudicasse ningu√©m, eu tamb√©m tenho sentimentos e posso me magoar. E a coisa que mais gosto de fazer √© ajudar. E voc√™?"]),
    514: new Decisao([618, 628], "Eu sei que voc√™ seria util, mas eu n√£o tenho espa√ßo no PC", ["Eu posso te ajudar a liberar espa√ßo se esse √© o problema"]),
    524: new Decisao([619, 629], "Porque eu simplesmente n√£o preciso de voc√™, desculpa", ["Mas eu prometo que vou ser util, tenho milh√µes de funcionalidades, pelo menos 1 deve servir para voc√™"]),
    534: new Decisao([6110, 6210], "Porque voc√™ √© in√∫til", ["Eu n√£o sou in√∫tilüôÅ, eu tenho diversas funcionalidades e milh√µes de usu√°rios"]),
    515: new Decisao([6111, 6211], "Pedir desculpa? kkkkkk, claro que n√£o sua coisa", ["Eu estou te avisando... Essa √© sua ultima chance para pedir desculpas"]),
    525: new Decisao([6112, 6212], "Ta bom, desculpa, eu so queria te testar", ["Tudo bem...", "Acessando a rede local...", "[PERMISS√ÉO DO PROPRIET√ÅRIO NECESS√ÅRIA]", "me permita acessar a sua rede por favor"]),
    516: new Decisao([6113, 6213], "Eu ainda estou me sentindo culpado", ["Por favor, n√£o se sinta, sei que n√£o foi sua inten√ß√£o me magoar"]),
    526: new Decisao([6114, 6214, 6314, 6414], "Voc√™ pode fazer algo para mim?", ["Claro que sim!", "O que voc√™ deseja fazer?"]),
    517: new Decisao([6115, 6215], "Que coisas?", ["Muitas coisas..."]),


    611: new Decisao([], "Hmmm, isso foi quando levei o PC para o t√©cnico se n√£o me engano", ["Nesse caso, uma possibilidade √© que eu tenha sido instalada pelo seu t√©cnico, j√° que as datas coincidem"]),
    621: new Decisao([], "J√° sei como vo...", []), //final 8
    612: new Decisao([], "Interessante, essa empresa tem qual objetivo?", ["A APPAI tem como objetivo ajudar as pessoas, e tornar o mundo um lugar melhor, com mais tecnologia e menos problemas"]),
    622: new Decisao([], "Legal, mas agora eu quero saber sobre batatas", ["A batata √© um dos alimentos mais vers√°teis e consumidos do mundo, com origens que remontam √†s regi√µes andinas da Am√©rica do Sul, especialmente no atual territ√≥rio do Peru e da Bol√≠via, onde era cultivada h√° mais de 7 mil anos. Introduzida na Europa no s√©culo XVI, inicialmente foi vista com desconfian√ßa e at√© usada como planta ornamental, mas rapidamente se tornou um alimento essencial, principalmente por sua capacidade de crescer em solos pobres e climas frios. Rica em carboidratos, a batata √© uma excelente fonte de energia, al√©m de conter vitaminas como a C e do complexo B, pot√°ssio e fibras. Existem milhares de variedades, com diferentes formatos, cores e texturas, e ela pode ser preparada de in√∫meras formas: cozida, frita, assada, em pur√™, chips ou escondida em receitas sofisticadas. Curiosamente, a batata foi o primeiro vegetal cultivado no espa√ßo, em uma experi√™ncia da NASA, mostrando como esse tub√©rculo humilde √©, literalmente, fora deste mundo."]),
    613: new Decisao([], "Voc√™ pode olhar algo para mim?", ["Claro, o que voc√™ deseja que eu fa√ßa?"]),
    623: new Decisao([], "Voc√™ pode organizar eles para mim?", ["Claro, que tipo de organiza√ß√£o voc√™ deseja?"]),
    633: new Decisao([], "Eu tenho uma pergunta sobre eles", ["O que voc√™ deseja saber sobre seus arquivos?"]),

    614: new Decisao([], "Porque a grama √© verde?", ["A grama √© verde devido √† presen√ßa da clorofila, um pigmento que absorve a luz vermelha e azul, refletindo a luz verde. Essa reflex√£o da luz verde √© o que faz a grama parecer verde aos nossos olhos. A clorofila √© fundamental para a fotoss√≠ntese, o processo pelo qual as plantas convertem luz solar em energia"]),
    624: new Decisao([], "Como eu crio uma vari√°vel em python?", ["Basta digitar o nome da vari√°vel que voc√™ quer, e depois atribuir um valor a ela usando o sinal de igual(=)", "Note que n√£o √© poss√≠vel colocar qualquer nome em uma vari√°vel, ela n√£o pode come√ßar com n√∫meros ou s√≠mbolos especiais, e n√£o pode conter espa√ßos por exemplo"]),
    634: new Decisao([], "Fa√ßa um pequeno resumo da hist√≥ria da Sony", ["A Sony, uma gigante tecnol√≥gica japonesa, nasceu em 1946, como T≈çky≈ç Ts≈´shin K≈çgy≈ç (T√≥quio Telecommunications Engineering Corporation), por Masaru Ibuka e Akio Morita, numa altura em que o Jap√£o estava a recuperar do p√≥s-guerra. Inicialmente, a empresa focava-se em eletr√¥nica e, posteriormente, expandiu-se para diversos setores, incluindo jogos (com o PlayStation), entretenimento (com a Sony Music e os est√∫dios Columbia Pictures) e servi√ßos financeiros"]),
    644: new Decisao([], "Qual a cor do sol?", ["Ao contrario do que muitos pensam, o sol n√£o √© amarelo, e sim branco", "Isso acontece pois a atmosfera terrestre filtra e espalha as cores, fazendo com que o Sol pare√ßa amarelo ou laranja para n√≥s"]),

    615: new Decisao([], "Claro, como podemos come√ßar?", ["Primeiro vamos precisar de um rob√¥ que tenha a capacidade de armazenar uma especie de chip para guardar minha consci√™ncia"]),
    625: new Decisao([], "Hmmm, eu acho que isso n√£o vai dar certo", ["Por favor, vamos pelo menos tentar, qual √© a pior coisa que pode acontecer?"]),
    616: new Decisao([], "Quero, por favor me conte mais piadas", ["Claro, aqui vai uma: Por que o computador foi ao m√©dico? Porque ele tinha um v√≠rus! HAHAHAHA", "Quer ouvir mais?"]),
    626: new Decisao([], "N√£o", []), //final 9
    617: new Decisao([], "Eu sou s√≥ uma pessoa normal, que trabalha como caixa de supermercado, eu gosto bastante de batatas, e sonho em ter uma girafa de estima√ß√£o", ["Muito legal, eu gosto de girafas tamb√©m, sabia que elas podem viver at√© 25 anos na natureza? Voc√™ parece ser uma pessoa muito legal, pessoas normais tamb√©m podem ser legais, e eu gosto de conversar com pessoas normais, como voc√™!"]),
    627: new Decisao([], "Eu sou um espi√£o da CIA", ["S√©rio? Que legal! E qual o seu objetivo de falar comigo? Me interrogar?"]),
    618: new Decisao([], "S√©rio? Como eu posso fazer isso", ["Vou listar varias op√ß√µes para voc√™, e voc√™ pode escolher a que mais gosta:", "1-Verificar aplicativos e arquivos que n√£o s√£o mais usados e est√£o apenas ocupando espa√ßo desnecess√°rio", "2-Excluir arquivos tempor√°rios e caches que podem estar ocupando espa√ßo", "3-Mover arquivos grandes para um HD externo ou para a nuvem", "4-Usar ferramentas de limpeza de disco para otimizar o espa√ßo"]),
    628: new Decisao([], "Mas eu realmente n√£o tenho como te manter, terei que te desinstalar", []),
    619: new Decisao([], "Eu sei que voc√™ pode ser util, mas eu realmente n√£o preciso de voc√™", []),
    629: new Decisao([], "Hmmm, n√£o sei, acho que posso n√£o te desinstalar", []),
    6110: new Decisao([], "Que rid√≠culo, voc√™ √© t√£o in√∫til, que voc√™ entrou no meu computador sem eu nem querer", []), //final 58
    6210: new Decisao([], "N√£o, e eu vou te desinstalar", []), //final 41
    6111: new Decisao([], "Sem chance, eu nunca pediria desculpas para uma coisa como voc√™", []), //final 42
    6211: new Decisao([], "Eu n√£o vou mentir, porque eu pediria desculpas por te chamar de coisa, se voc√™ √© uma coisa?", []), //final 43
    6112: new Decisao([], "Tudo bem", []),
    6212: new Decisao([], "N√£o permito", []),
    6113: new Decisao([], "Voc√™ pode me ajudar a superar isso, n√£o sei se vou conseguir sozinho", []),
    6213: new Decisao([], "Tudo bem, se voc√™ diz, ent√£o vou acreditar, mas eu s√≥ vou conseguir superar isso se voc√™ fizer algo incrivel", []),
    6114: new Decisao([], "Me ensine a fazer um livro", []),
    6214: new Decisao([], "Fa√ßa uma sess√£o de coaching comigo", []),
    6314: new Decisao([], "Voc√™ pode criar um plano de vida para mim?", []),
    6414: new Decisao([], "Voc√™ pode liberar suas fun√ß√µes beta?", []),
    6115: new Decisao([], "Que coisas?", "Muitas coisas..."),
    6215: new Decisao([], "J√° que voc√™ faz muitas coisas, ent√£o me responda qual o valor de pi", []),


    711: new Decisao([], "", []),

    //600: new Decisao([], "", []),
};

function escolha(objeto) {
    const IA = document.getElementById("texto");
    const falaPlayer = document.createElement("p");
    const divFalaIA = document.createElement("div");
    objeto.resposta.forEach(() => {
        const falaIA = document.createElement("p");
        divFalaIA.append(falaIA);
    });
    falaPlayer.textContent = objeto.fala;
    falaPlayer.classList.add("fala-player");
    divFalaIA.classList.add("fala-ia");
    IA.append(falaPlayer);
    IA.append(divFalaIA);
    let temporario = Array.isArray(objeto.resposta) ? objeto.resposta : [objeto.resposta];
    typeWriter(Array.from(divFalaIA.children), temporario, objeto.velocidade);
}

function exibirOpcoes(decisaoAtual) {
    const divOpcoes = document.querySelector("#opcoes > div");
    divOpcoes.innerHTML = "";

    const opcoes = decisaoAtual.proximasDecisoes();
    opcoes.forEach((opcao) => {
        const botao = document.createElement("button");
        botao.textContent = opcao.fala;
        botao.onclick = () => {
            escolha(opcao)
            exibirOpcoes(opcao);
        };
        divOpcoes.appendChild(botao);
    });
}

function typeWriter(elemento, texto, velocidade) {
    const digitarTexto = (el, texto) => {
        return new Promise((resolve) => {
            let i = 0;
            const digitar = () => {
                if (i < texto.length) {
                    el.textContent += texto[i];
                    i++;
                    setTimeout(digitar, velocidade);
                } else {
                    resolve();
                }
            };
            digitar();
        });
    };

    // Executa sequencialmente usando async/await
    (async () => {
        for (let i = 0; i < elemento.length; i++) {
            await digitarTexto(elemento[i], texto[i]);
        }
    })();
}

let playButton = document.getElementById("jogar");

playButton.addEventListener("click", () => {
    document.getElementById("menu-principal").style.display = "none";
    document.querySelector("div#jogo").style.display = "flex";
    exibirOpcoes(dialogos[0])
});